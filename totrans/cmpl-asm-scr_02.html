<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Chapter 2
TypeScript Basics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Chapter 2
TypeScript Basics</h1>
<blockquote>原文：<a href="https://keleshev.com/compiling-to-assembly-from-scratch/02-typescript-basics">https://keleshev.com/compiling-to-assembly-from-scratch/02-typescript-basics</a></blockquote>




<header>

<a href="./#table-of-contents">Compiling to Assembly from Scratch</a>
<br/>by <a href="/">Vladimir Keleshev</a>
</header>
<p> </p>
<!-- TODO? Example of `every` -->
<p>This chapter gets you up-to-speed with TypeScript. Feel free to skip it if you already know it.</p>
<p>TypeScript is designed to be a <em>superset</em> (or an extension) to JavaScript that adds type annotations and type checking. So, apart from the type annotations, it is just modern-day JavaScript.</p>
<p>Let’s get going. First, <code>console.log</code> prints a message to the console:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"/><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Hello, world!"</span>)<span class="op">;</span></span></code></pre></div>
<p>Strings use double or single quotes. Strings written with back-ticks are called <em>template literals</em>. They can be multiline, <em>and</em> they can be interpolated (or injected with expressions), like in a template:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"/><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`2 + 2 = </span><span class="sc">${</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span> <span class="co">// Prints: 2 + 2 = 4</span></span></code></pre></div>
<p>Next, <code>console.assert</code> is a quick and portable way to test something, if you don’t have a testing framework at hand:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"/><span class="bu">console</span><span class="op">.</span><span class="fu">assert</span>(<span class="dv">2</span> <span class="op">===</span> <span class="dv">2</span>)<span class="op">;</span> <span class="co">// Does nothing</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"/><span class="bu">console</span><span class="op">.</span><span class="fu">assert</span>(<span class="dv">0</span> <span class="op">===</span> <span class="dv">2</span>)<span class="op">;</span> <span class="co">// Raises an exception</span></span></code></pre></div>
<p>Triple equals <code>===</code> is strict (or exact) equality, while double equals <code>==</code> is loose equality. Similarly with <code>!==</code> and <code>!=</code>. For example, with loose equality <code>true</code> equals to <code>1</code>, but with strict equality they are not equal. We will only use strict equality in the compiler code, but in the basline language we will use <code>==</code> and <code>!=</code> operators.</p>
<p>To abnormally terminate a program, you can throw an exception:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"/><span class="cf">throw</span> <span class="bu">Error</span>(<span class="st">"Error message goes here."</span>)<span class="op">;</span></span></code></pre></div>
<p>It is a good practice to define your own exceptions, but for brevity, we’ll use built-in exceptions in this book.</p>
<p>Functions can be defined using the <code class="sourceCode javascript"><span class="kw">function</span></code> keyword:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"/><span class="kw">function</span> <span class="fu">add</span>(a<span class="op">:</span> number<span class="op">,</span> b<span class="op">:</span> number) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"/>  <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"/>}</span></code></pre></div>
<p>In many cases, type annotations are optional in TypeScript. However, they are necessary for most function (and method) parameters. So far, we were describing features that are just plain JavaScript. However, here we’ve got a function that has a <em>type annotation</em>. The types of the parameters are <em>annotated</em> as <code>number</code>.</p>
<p>Another way to define a function is by writing a so-called <em>arrow function</em>, (which is also called an <em>anonymous function</em>, or a <em>lambda function</em>):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"/><span class="kw">let</span> add <span class="op">=</span> (a<span class="op">,</span> b) <span class="kw">=&gt;</span> a <span class="op">+</span> b<span class="op">;</span></span></code></pre></div>
<p>Next up are variables. They come in several forms in TypeScript (and JavaScript). Variables are bound with <code class="sourceCode javascript"><span class="kw">var</span></code>, <code class="sourceCode javascript"><span class="kw">let</span></code> (and <code class="sourceCode javascript"><span class="kw">const</span></code>). While <code class="sourceCode javascript"><span class="kw">var</span></code> scope is at the function (or method) level, <code class="sourceCode javascript"><span class="kw">let</span></code> scope is delimited with braces.</p>
<p>Compare <code class="sourceCode javascript"><span class="kw">var</span></code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"/><span class="kw">function</span> <span class="fu">f</span>() {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"/>  <span class="kw">var</span> x <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"/>  {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"/>    <span class="kw">var</span> x <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"/>  }</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"/>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(x)<span class="op">;</span> <span class="co">// Prints 2</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"/>}</span></code></pre></div>
<p>With <code class="sourceCode javascript"><span class="kw">let</span></code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"/><span class="kw">function</span> <span class="fu">f</span>() {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"/>  <span class="kw">let</span> x <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"/>  {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"/>    <span class="kw">let</span> x <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"/>  }</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"/>  <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(x)<span class="op">;</span> <span class="co">// Prints 1</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"/>}</span></code></pre></div>
<p>We’ll only be using <code class="sourceCode javascript"><span class="kw">let</span></code> in the compiler code, however, <code class="sourceCode javascript"><span class="kw">var</span></code> needs mentioning because it is <code class="sourceCode javascript"><span class="kw">var</span></code> that we will implement for the baseline language.</p>
<p>Although mostly optional, bindings can be type-annotated:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"/><span class="kw">let</span> a<span class="op">:</span> <span class="bu">Array</span><span class="op">&lt;</span>number<span class="op">&gt;</span> <span class="op">=</span> [<span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>]<span class="op">;</span></span></code></pre></div>
<p>Here, <code>Array&lt;number&gt;</code> means an array of numbers.</p>
<p>TypeScript, like JavaScript, allows for literal regular expressions. While strings are delimited with quotes, literal regular expressions are delimited with forward slashes:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"/><span class="kw">let</span> result <span class="op">=</span> <span class="st">"hello world"</span><span class="op">.</span><span class="fu">match</span>(<span class="ss">/</span><span class="sc">[a-z]+</span><span class="ss">/</span>)<span class="op">;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"/><span class="bu">console</span><span class="op">.</span><span class="fu">assert</span>(result[<span class="dv">0</span>] <span class="op">===</span> <span class="st">"hello"</span>)<span class="op">;</span></span></code></pre></div>
<p>Classes are the go-to way for creating custom data types in TypeScript. Here’s a simple data class:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"/><span class="kw">class</span> Pair {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"/>  <span class="kw">public</span> <span class="dt">first</span><span class="op">:</span> number<span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"/>  <span class="kw">public</span> <span class="dt">second</span><span class="op">:</span> number<span class="op">;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"/></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"/>  <span class="fu">constructor</span>(<span class="dt">first</span><span class="op">:</span> number<span class="op">,</span> <span class="dt">second</span><span class="op">:</span> number) {</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"/>    <span class="kw">this</span><span class="op">.</span><span class="at">first</span> <span class="op">=</span> first<span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"/>    <span class="kw">this</span><span class="op">.</span><span class="at">second</span> <span class="op">=</span> second<span class="op">;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"/>  }</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"/>}</span></code></pre></div>
<p>You create a new object using the <code class="sourceCode javascript"><span class="kw">new</span></code> keyword:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"/><span class="kw">let</span> origin <span class="op">=</span> <span class="kw">new</span> <span class="fu">Pair</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span></code></pre></div>
<p>TypeScript has a shortcut for defining simple data classes like this, where constructor parameters are immediately assigned as instance variables:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"/><span class="kw">class</span> Pair {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"/>  <span class="fu">constructor</span>(<span class="kw">public</span> <span class="dt">first</span><span class="op">:</span> number<span class="op">,</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"/>              <span class="kw">public</span> <span class="dt">second</span><span class="op">:</span> number) {}</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"/>}</span></code></pre></div>
<p>Note how the <code class="sourceCode javascript"><span class="kw">public</span></code> keyword is specified in the parameter list. This is exactly equivalent to the previous definition. We will use this shortcut a lot in this book.</p>
<p>We will also define some classes that can clash with the built-in ones, like <code>Boolean</code> and <code>Number</code>. To avoid that, make sure to define them at the module scope and not at the global scope. The simplest way to acheive that is to make sure to add an empty <code><b>export </b></code><code>{}</code> to your source file. Using <code><b>import</b></code>  or <code><b>export</b></code>  keywords changes the file scope from global to module scope.</p>
<p>Next is a more extensive example, with static variable <code>zero</code>, static method <code>origin</code>, and an instance method <code>toString</code>. Remember that static variables and static methods are just global variables and global methods that are namespaced by the class name.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"/><span class="kw">class</span> Pair {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"/>  <span class="kw">static</span> zero <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"/></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"/>  <span class="kw">static</span> <span class="fu">origin</span>() {</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"/>    <span class="cf">return</span> <span class="kw">new</span> <span class="fu">Pair</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"/>  }</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"/></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"/>  <span class="fu">constructor</span>(<span class="kw">public</span> <span class="dt">first</span><span class="op">:</span> number<span class="op">,</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"/>              <span class="kw">public</span> <span class="dt">second</span><span class="op">:</span> number) {}</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"/></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"/>  <span class="fu">toString</span>() {</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"/>    <span class="cf">return</span> <span class="vs">`(</span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">first</span><span class="sc">}</span><span class="vs">, </span><span class="sc">${</span><span class="kw">this</span><span class="op">.</span><span class="at">second</span><span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"/>  }</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"/>}</span></code></pre></div>
<p>You might find that some of the whitespace and formatting choices look odd in this book. This is because the code listings are optimized for compactness, which is important for a print book.</p>
<hr/>
<p>There’s much more to TypeScript, but we will, for the most part, limit ourselves to the subset described here.</p>
<center><a href="./03-high-level-compiler-overview">Next: Chapter 3. High-level Compiler Overview</a></center>


  <hr class="fleuron"/>
    
</body>
</html>