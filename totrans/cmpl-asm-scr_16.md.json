["```js\nlet numberTag = 0b00;\nlet pointerTag = 0b01;\nlet falsyTag = 0b10;\nlet truthyTag = 0b11;\n```", "```js\nlet trueBitPattern = 0b111;\nlet falseBitPattern = 0b110;\nlet undefinedBitPattern = 0b010;\n```", "```js\nlet toSmallInteger = (n: number) => n << 2;\n```", "```js\nlet tagBitMask = 0b11;\n```", "```js\n visitNumber(node: Number) {\n emit(`  ldr r0, =${toSmallInteger(node.value)}`);\n }\n```", "```js\n visitBoolean(node: Boolean) {\n if (node.value) {\n emit(`  mov r0, #${trueBitPattern}`);\n } else {\n emit(`  mov r0, #${falseBitPattern}`);\n }\n }\n\n visitUndefined(node: Undefined) {\n emit(`  mov r0, #${undefinedBitPattern}`);\n }\n```", "```js\n visitAdd(node: Add) {\n node.left.visit(this);\n emit(`  push {r0, ip}`);\n node.right.visit(this);\n emit(`  pop {r1, ip}`);\n\n // Are both small integers?\n emit(`  orr r2, r0, r1`);\n emit(`  and r2, r2, #${tagBitMask}`);\n emit(`  cmp r2, #0`);\n\n emit(`  addeq r0, r1, r0`);\n emit(`  movne r0, #${undefinedBitPattern}`);\n }\n```", "```js\n visitNot(node: Not) {\n node.term.visit(this);\n\n // Is falsy?\n emit(`  cmp r0, #0`);\n emit(`  andne r0, r0, #${tagBitMask}`)\n emit(`  cmpne r0, #${falsyTag}`);\n\n emit(`  moveq r0, #${trueBitPattern}`);\n emit(`  movne r0, #${falseBitPattern}`);\n }\n```", "```js\n emitCompareFalsy() {\n emit(`  cmp r0, #0`);\n emit(`  andne r0, r0, #${tagBitMask}`)\n emit(`  cmpne r0, #${falsyTag}`);\n }\n```", "```js\n visitArrayLiteral(node: ArrayLiteral) {\n emit(`  ldr r0, =${4 * (node.args.length + 1)}`);\n emit(`  bl malloc`);\n emit(`  push {r4, ip}`);\n emit(`  mov r4, r0`);\n emit(`  ldr r0, =${toSmallInteger(node.args.length)}`);\n emit(`  str r0, [r4]`);\n node.args.forEach((arg, i) => {\n arg.visit(this);\n emit(`  str r0, [r4, #${4 * (i + 1)}]`);\n });\n emit(`  add r0, r4, #1`);  // Move to r0 and add tag\n emit(`  pop {r4, ip}`);\n }\n```", "```js\n visitLength(node: Length) {\n node.array.visit(this);\n emit(`  ldr r0, [r0, #-1]`);\n }\n```", "```js\n visitArrayLookup(node: ArrayLookup) {\n node.array.visit(this);\n emit(`  bic r0, r0, #${pointerTag}`); // Remove tag\n emit(`  push {r0, ip}`);\n node.index.visit(this);\n emit(`  pop {r1, ip}`);\n emit(`  ldr r2, [r1], #4`);\n emit(`  cmp r0, r2`);\n emit(`  movhs r0, #${undefinedBitPattern}`);\n emit(`  ldrlo r0, [r1, r0]`);\n }\n```", "```js\nfunction isBoolean(x) {\n if (x == true) {\n return true;\n } else if (x == false) {\n return true;\n } else {\n return false;\n }\n}\n\nfunction main() {\n var a = [];\n assert(a[1] + 2 == undefined);\n\n assert(!isBoolean(undefined));\n}\n```"]